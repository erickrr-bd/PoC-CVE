/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */
package com.tekium.log4j2vuln;

import java.util.List;
import java.io.IOException;
import java.io.OutputStream;
import org.apache.logging.log4j.Logger;
import com.sun.net.httpserver.HttpHandler;
import com.sun.net.httpserver.HttpExchange;
import org.apache.logging.log4j.LogManager;

/**
 *
 * @author Erick Roberto Rodriguez Rodriguez
 */
public class Log4j2Vuln_Handler implements HttpHandler {
    
    static Logger log = LogManager.getLogger(Log4j2Vuln_Handler.class.getName());

    /**
     * Method that receives a request and sends a response.
     * @param exchange This object encapsulates a HTTP request received and a response to be generated in one exchange.
     * @throws IOException 
     */
    @Override
    public void handle(HttpExchange exchange) throws IOException {
        List<String> api_version = exchange.getRequestHeaders().get("X-Api-Version");
        log.info("Requested API Version: {}", api_version);
        String response = "<h1>Payload received!!! " + api_version + "</h1>";
        exchange.sendResponseHeaders(200, response.length());
        try(OutputStream os = exchange.getResponseBody()){
            os.write(response.getBytes());
        }
    }
}
